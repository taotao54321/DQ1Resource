+++
title = "RAM マップ"
date = 2021-09-23
+++

## 概要

|アドレス|型|内容|
|--|--|--|
|`$00-$01`||雑用|
|`$02`|`u8`|NMI完了待ち用(NMI完了時に 0 になる)。通常は 1 にしてNMIの完了を待つ。0xFF にするとNMI内のPPU関連処理がスキップされる|
|`$03`|`u8`|PPUデータ転送キューの要素数|
|`$04`|`u8`|PPUデータ転送キューの現在のオフセット|
|`$05`|`u16`|PPUスクロールオフセットx|
|`$07`|`u8`|PPUスクロールオフセットy|
|`$08-$10`||雑用|
|`$11`|`ptr`|現在のマップデータへのポインタ|
|`$13`|`u8`|現在のマップ座標x最大値(この値 +1 がマップ幅となる)|
|`$14`|`u8`|現在のマップ座標y最大値(この値 +1 がマップ高さとなる)|
|`$15`|`u8`|現在のマップの範囲外を埋める地形|
|`$16`|`u8`|現在のマップ種別 (0:フィールド, 0x20:洞窟, 0x10:それ以外)|
|`$17`|`ptr`|現在のマッププレーンデータへのポインタ (0 の場合無効)|
|`$19`|`u8`|現在位置のマッププレーン (0:表, 8:裏)|
|`$1A`|`u8[8][2]`|開けた扉の座標 (x,y) の配列|
|`$2A`|`u8[8][2]`|開けた宝箱の座標 (x,y) の配列|
|`$3A`|`u8`|現在位置のマップ座標x|
|`$3B`|`u8`|現在位置のマップ座標y|
|`$3C-$43`||雑用|
|`$44`||(未使用)|
|`$45`|`u8`|現在のマップID|
|`$46`|`u8`|雑用 (入力読み取り時の拡張ポート対応用)|
|`$47`|`u8`|入力 (RLDUTSBA)|
|`$48`|||
|`$49`|||
|`$4A`|||
|`$4B`|||
|`$4C`|||
|`$4D-$4E`||雑用|
|`$4F`|`u8`|NMIカウンタ|
|`$50`|`u8`|シンボルアニメーションカウンタ (16F ごとに 8 増え、値が 16 の倍数かどうかでシンボルスプライトを切り替える)|
|`$51-$8C`|`u8[20][3]`|NPCシンボル管理用|
|`$8D`|`u8`|NPCシンボル移動カウンタ (0xFF のときNPCシンボル無効。さもなくば mod 5 で 16F ごとに 1 増える)|
|`$8E`|`u8`|移動先マップ座標x|
|`$8F`|`u8`|移動先マップ座標y|
|`$90`|`u16`|マップ上でのピクセル座標x|
|`$92`|`u16`|マップ上でのピクセル座標y|
|`$94`|`u16`|乱数|
|`$96`|`u8`|NPCの移動を禁止するか (0:false, 0xFF:true)|
|`$97-$A1`||雑用|
|`$A2`||(未使用)|
|`$A3-$B4`|||
|`$B5-$B9`|`u8[5]`|主人公 名前|
|`$BA`|`u16`|主人公 経験値|
|`$BC`|`u16`|所持金|
|`$BE`|`u8`|装備 (bit0-1:盾, bit2-4:鎧, bit5-7:武器)|
|`$BF`|`u8`|かぎ所持数|
|`$C0`|`u8`|やくそう所持数|
|`$C1-$C4`|`u8[4]`|インベントリ (1Byte あたり 2 個。4bit の道具IDが下位ニブルから順に格納される)|
|`$C5`|`u8`|主人公 HP|
|`$C6`|`u8`|主人公 MP|
|`$C7`|`u8`|主人公 レベル|
|`$C8`|`u8`|主人公 力|
|`$C9`|`u8`|主人公 素早さ|
|`$CA`|`u8`|主人公 最大HP|
|`$CB`|`u8`|主人公 最大MP|
|`$CC`|`u8`|主人公 攻撃力|
|`$CD`|`u8`|主人公 守備力|
|`$CE`|`u8`|呪文習得フラグ|
|`$CF`|`u8`|呪文習得/各種フラグ|
|`$D0`|`u8`|光源範囲 (1, 3, 5, 7 のいずれか。通常時 1, たいまつ使用で 3, レミーラ使用で 7 になる)|
|`$D1-$D9`|||
|`$DA`|`u8`|光源カウンタ|
|`$DB`|`u8`|聖水/トヘロス効果 (bit0:0=聖水,1=トヘロス, bit1-7:残量)|
|`$DC-$DE`||雑用|
|`$DF`|`u8`|各種フラグ|
|`$E0`|`u8`|敵 モンスターID|
|`$E1`|||
|`$E2`|`u8`|敵 HP|
|`$E3`|`u8`|まほうのよろい装備時の歩数カウンタ (4 の倍数のときHPが 1 回復)|
|`$E4`|`u8`|各種フラグ|
|`$E5`|`u8`|メッセージウェイト設定 (0:FAST, 1:NORMAL, 2:SLOW)|
|`$E6-$FF`|||
|`$0100`|`u8`|敵 攻撃力|
|`$0101`|`u8`|敵 守備力|
|`$0102`|`u8`|敵 最大HP|
|`$0103`|`u8`||
|`$0104`|`u8`|敵 マホトーン耐性/ラリホー耐性 (bit0-3:マホトーン耐性, bit4-7:ラリホー耐性)|
|`$0105`|`u8`|敵 回避力/攻撃呪文耐性 (bit0-3:回避力, bit4-7:攻撃呪文耐性)|
|`$0106`|`u8`|敵 経験値|
|`$0107`|`u8`|敵 金基本値|
|`$0108-$0111`|`u8`|敵 名前|
|`$0112-$01FF`||スタック領域|
|`$0200-$02FF`|`Sprite[64]`|スプライトバッファ|
|`$0300-$03BF`|`u8[192]`|PPUデータ転送キュー|
|`$03C0-$03FF`|||
|`$0400-$07BF`|||
|`$07C0-$07FF`|||


